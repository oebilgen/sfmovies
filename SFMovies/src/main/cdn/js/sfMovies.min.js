function initialize(){map=new google.maps.Map(document.getElementById("map"),{zoom:defaultZoom,center:defaultCenter,mapTypeId:google.maps.MapTypeId.ROADMAP});setTimeout(showAllMarkers,0)}function showMarkers(e,t){var n=endpointPrefix+e;if(t!=""){n+="/"+t;$("#query").val(decodeURIComponent(t))}$.ajax({type:"GET",dataType:"json",url:n,success:function(t){if(t.success){if(e!="all"){if(markerCluster!=null){markerCluster.clearMarkers()}map.setZoom(searchZoom);map.setCenter(searchCenter)}movies=t.data;if(movies.length===0){alert("No results.");return}else{console.log(movies.length+" results");infoWindow=new google.maps.InfoWindow({});var n=new OverlappingMarkerSpiderfier(map,{markersWontMove:true,markersWontHide:true,legWeight:1});n.addListener("click",function(e){infoWindow.setContent(createDescription(e.movieId,e.locationId));infoWindow.open(map,e)});n.addListener("spiderfy",function(e){for(var t=0;t<e.length;t++){e[t].setIcon(spiderfiedIcon)}infoWindow.close()});n.addListener("unspiderfy",function(e){for(var t=0;t<e.length;t++){e[t].setIcon(usualIcon)}});var r=new google.maps.LatLngBounds;var i=[];var s;for(s=0;s<movies.length;s++){var o=movies[s];if(e=="movieId"){$("#query").val(o.title)}var u=o.movieLocations;if(u==null||u.length==0){console.info('The movie "'+o.title+'" does not have a known address, skipping...');continue}for(var a=0;a<u.length;a++){movieLocation=u[a];if(movieLocation==null){console.error("DATA ERROR: title:"+o.title+" movieLocation:%o",movieLocation);continue}var f=new google.maps.LatLng(movieLocation.latitude,movieLocation.longitude);r.extend(f);var l=new google.maps.Marker({position:f,title:o.title,icon:usualIcon,movieId:s,locationId:a});n.addMarker(l);i.push(l);console.log("Added marker at "+f)}}markerCluster=new MarkerClusterer(map,i);markerCluster.setMaxZoom(14);if(s==0&&e=="movieId"){$("#query").val("")}}}else{console.error("Failed to retrieve the results: "+JSON.stringify(t.errorMessage))}},error:function(e,t,n){alert("Error occured: "+JSON.stringify(t));console.log("textStatus: "+t);console.log("errorThrown: "+n);console.log("jqXHR"+e)}})}function createDescription(e,t){var n=movies[e];var r='<div class="infoWindow"><span class="movieTitle">'+n.title+' (<a href="#" class="infoWindowLink" onclick="showMarkers(\'releaseYear\', \''+encodeURIComponent(n.releaseYear)+"')\">"+n.releaseYear+"</a>)</span><br>";r+='Director: <a href="#" class="infoWindowLink" onclick="showMarkers(\'director\', \''+encodeURIComponent(n.director)+"')\">"+n.director+"</a><br>";var i=[];var s="";for(var o=0;o<n.actors.length;o++){i.push('<a href="#" class="infoWindowLink" onclick="showMarkers(\'actor\', \''+encodeURIComponent(n.actors[o])+"')\">"+n.actors[o]+"</a>");s+=" #"+n.actors[o].replace(" ","")}r+="Actors: "+i.join(", ")+"<br>";r+='Production Company: <a href="#" class="infoWindowLink" onclick="showMarkers(\'productionCompany\', \''+encodeURIComponent(n.productionCompany)+"')\">"+n.productionCompany+"</a><br>";r+='Distributor: <a href="#" class="infoWindowLink" onclick="showMarkers(\'distributor\', \''+encodeURIComponent(n.distributor)+"')\">"+n.distributor+"</a><br>";r+='Writer: <a href="#" class="infoWindowLink" onclick="showMarkers(\'writer\', \''+encodeURIComponent(n.writer)+"')\">"+n.writer+"</a><br>";var u=n.movieLocations[t].formattedAddress;r+='Address: <a href="https://www.google.com/maps/?q='+encodeURIComponent(u)+'" class="infoWindowLink" target="_blank">'+u+"</a><br>";r+='<div class="shareButtons"><input type="button" onclick="window.open(\'http://google.com/search?q='+encodeURIComponent(n.title+" "+n.releaseYear+" movie watch online")+'\');" value="Watch online"> ';r+='<input type="button" onclick="window.open(\'http://www.amazon.com/s/ref=nb_sb_noss_1?field-keywords='+encodeURIComponent(n.title+" "+n.releaseYear)+' movie\');" value="Buy on Amazon"> ';r+='<input type="button" onclick="window.open(\'https://www.uber.com/invite/uberoebilgen\');" value="Request Uber"> ';r+='<input type="button" onclick="window.open(\'/?movieId='+n.id+'\');" value="Link"> ';r+='<input type="button" onclick="window.open(\'http://twitter.com/share?url=http://www.sfmovies.org/?movieId='+n.id+"&text="+n.title+encodeURIComponent(" #sanfrancisco #movie"+s)+"&via=oebilgen&related=uber', '', 'width=575, height=230');\" value=\"Tweet\"> ";r+="</div></div>";return r}function getQueryString(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return n==null?"":decodeURIComponent(n[1].replace(/\+/g," "))}function toggleFullScreen(){if(isFullScreen){$("#fullScreenButton").prop("value","Full screen");$("#fullScreenButton").animate({margin:"58px 72px auto auto"});$("#header").animate({width:"90%",margin:"50px auto 0px auto"});$("#map").animate({width:"90%",height:"450px"})}else{$("#fullScreenButton").prop("value","Theather view");$("#fullScreenButton").animate({margin:"8px 0px auto auto"});$("#header").animate({width:"100%",margin:"0px auto 0px auto"});$("#map").animate({width:"100%",height:"100%"})}isFullScreen=!isFullScreen}var defaultCenter=new google.maps.LatLng(37.7954783,-122.4052922);var defaultZoom=15;var searchCenter=new google.maps.LatLng(37.7194362,-122.4150745);var searchZoom=11;var endpointPrefix="/v1/movies/";var map=null;var movies=null;var overlappingMarkerSpiderfier=null;var infoWindow=null;var markerCluster=null;var usualIcon="images/usualIcon.png";var spiderfiedIcon="images/spiderfiedIcon.png";$(document).ready(function(){var e,t;e={serviceUrl:endpointPrefix+"search",showNoSuggestionNotice:true,maxHeight:"60%",onSelect:function(e,t){var n="";switch(e.data){case"ACTOR":n="actor";break;case"DIRECTOR":n="director";break;case"DISTRIBUTOR":n="distributor";break;case"PRODUCTION_COMPANY":n="productionCompany";break;case"RELEASE_YEAR":n="releaseYear";break;case"TITLE":n="title";break;case"WRITER":n="writer";break;default:alert("Unknown search result: "+t);return}showMarkers(n,e.value)},formatResult:function(e,t,n){var r="";switch(e.data){case"ACTOR":r="actor";break;case"DIRECTOR":r="director";break;case"DISTRIBUTOR":r="distributor";break;case"PRODUCTION_COMPANY":r="production company";break;case"RELEASE_YEAR":r="release year";break;case"TITLE":r="title";break;case"WRITER":r="writer";break;default:alert("Unknown search result: "+e.data);return}return e.value.replace(t,"<strong>"+t+"</strong>")+' <span class="searchDescription"><font color="silver">'+r+"</font></span>"}};t=$("#query").autocomplete(e);$("#query").keyup(function(e){if($(this).val().length===0){showMarkers("all","")}})});var isFullScreen=false;google.maps.event.addDomListener(window,"load",initialize)